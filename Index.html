<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HarmonyStream | Professional Music Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
            --success-color: #28a745;
            --player-height: 100px;
        }

        body {
            background-color: var(--dark-color);
            color: var(--light-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo i {
            font-size: 2.2rem;
        }

        .upload-btn {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }

        /* Player Section */
        .player-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .player-section h2 {
            margin-bottom: 25px;
            font-size: 1.5rem;
            color: #fff;
        }

        /* Music Player */
        .music-player {
            background: linear-gradient(135deg, rgba(37, 117, 252, 0.1), rgba(106, 17, 203, 0.1));
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .song-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .album-art {
            width: 120px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            flex-shrink: 0;
        }

        .album-art img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .song-details {
            flex-grow: 1;
        }

        .song-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-artist {
            font-size: 1.2rem;
            color: var(--gray-color);
            margin-bottom: 10px;
        }

        .progress-area {
            margin-bottom: 25px;
        }

        .progress-bar {
            height: 6px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
            position: relative;
            transition: width 0.1s linear;
        }

        .timer {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-bottom: 20px;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .play-pause {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            width: 60px;
            height: 60px;
            font-size: 1.8rem;
        }

        .play-pause:hover {
            transform: scale(1.1);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .volume-control i {
            color: var(--gray-color);
        }

        .volume-slider {
            flex-grow: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
        }

        .volume-percent {
            height: 100%;
            width: 70%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
        }

        /* Playlist Styles */
        .playlist-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            max-height: 500px;
            overflow-y: auto;
        }

        .playlist-section h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            color: #fff;
        }

        .playlist {
            list-style: none;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.03);
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .playlist-item.active {
            background: linear-gradient(90deg, rgba(106, 17, 203, 0.2), rgba(37, 117, 252, 0.2));
            border-left: 4px solid var(--primary-color);
        }

        .playlist-item img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin-right: 15px;
            object-fit: cover;
        }

        .playlist-details {
            flex-grow: 1;
        }

        .playlist-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .playlist-artist {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .playlist-duration {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        /* Online Streaming Section */
        .streaming-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stream-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stream-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .stream-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .stream-card h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .stream-card p {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        /* File Upload Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--dark-color);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--gray-color);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(106, 17, 203, 0.05);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .uploaded-files {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .uploaded-file {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .song-info {
                flex-direction: column;
                text-align: center;
            }
            
            .controls {
                gap: 15px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            
            .play-pause {
                width: 55px;
                height: 55px;
                font-size: 1.6rem;
            }
            
            .streaming-section {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .upload-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .player-section, .playlist-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <i class="fas fa-music"></i>
                <span>Jizzmile</span></span>
            </div>
            <button class="upload-btn" id="uploadTrigger">
                <i class="fas fa-cloud-upload-alt"></i>
                Upload Local Files
            </button>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <div class="left-column">
                <!-- Player Section -->
                <section class="player-section">
                    <h2>Now Playing</h2>
                    <div class="music-player">
                        <div class="song-info">
                            <div class="album-art" id="albumArt">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="song-details">
                                <div class="song-title" id="songTitle">Select a song to play</div>
                                <div class="song-artist" id="songArtist">Artist name</div>
                                <div class="song-album" id="songAlbum">Album name</div>
                            </div>
                        </div>

                        <div class="progress-area">
                            <div class="progress-bar" id="progressBar">
                                <div class="progress" id="progress"></div>
                            </div>
                            <div class="timer">
                                <span class="current-time" id="currentTime">0:00</span>
                                <span class="duration" id="duration">0:00</span>
                            </div>
                        </div>

                        <div class="controls">
                            <button class="control-btn" id="prevBtn">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="control-btn" id="repeatBtn">
                                <i class="fas fa-redo"></i>
                            </button>
                            <button class="control-btn play-pause" id="playPauseBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" id="shuffleBtn">
                                <i class="fas fa-random"></i>
                            </button>
                            <button class="control-btn" id="nextBtn">
                                <i class="fas fa-step-forward"></i>
                            </button>
                        </div>

                        <div class="volume-control">
                            <i class="fas fa-volume-up"></i>
                            <div class="volume-slider" id="volumeSlider">
                                <div class="volume-percent" id="volumePercent"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Online Streaming Section -->
                <section class="player-section">
                    <h2>Online Streaming</h2>
                    <div class="streaming-section" id="streamingSection">
                        <!-- Online tracks will be populated here -->
                    </div>
                </section>
            </div>

            <!-- Playlist Section -->
            <div class="right-column">
                <section class="playlist-section">
                    <h3>Playlist</h3>
                    <ul class="playlist" id="playlist">
                        <!-- Playlist items will be populated here -->
                    </ul>
                </section>
            </div>
        </div>

        <!-- File Upload Modal -->
        <div class="modal" id="uploadModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Upload Local Music Files</h3>
                    <button class="close-modal" id="closeModal">&times;</button>
                </div>
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-file-audio"></i>
                    <p>Drag & drop your music files here or click to browse</p>
                    <p class="small-text">Supports MP3, WAV, OGG, FLAC formats</p>
                    <input type="file" class="file-input" id="fileInput" accept="audio/*" multiple>
                </div>
                <div class="uploaded-files" id="uploadedFiles">
                    <!-- Uploaded files list will appear here -->
                </div>
                <button class="upload-btn" id="addToPlaylist" style="width: 100%; justify-content: center;">
                    <i class="fas fa-plus-circle"></i>
                    Add to Playlist
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>HarmonyStream Music Player &copy; 2023 | Play local files and stream online music</p>
        <p>For demonstration purposes only</p>
    </footer>

    <!-- Audio Element -->
    <audio id="audioPlayer"></audio>

    <script>
        // DOM Elements
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumePercent = document.getElementById('volumePercent');
        const songTitle = document.getElementById('songTitle');
        const songArtist = document.getElementById('songArtist');
        const songAlbum = document.getElementById('songAlbum');
        const albumArt = document.getElementById('albumArt');
        const playlist = document.getElementById('playlist');
        const uploadTrigger = document.getElementById('uploadTrigger');
        const uploadModal = document.getElementById('uploadModal');
        const closeModal = document.getElementById('closeModal');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadedFiles = document.getElementById('uploadedFiles');
        const addToPlaylistBtn = document.getElementById('addToPlaylist');
        const streamingSection = document.getElementById('streamingSection');

        // Player state
        let currentSongIndex = 0;
        let isPlaying = false;
        let isShuffled = false;
        let repeatMode = 'none'; // none, one, all
        let uploadedTracks = [];
        let onlineTracks = [];

        // Sample online streaming tracks (in a real app, these would come from an API)
        const sampleOnlineTracks = [
            {
                id: 1,
                title: "lift ur body",
                artist: "Jizzmile",
                album: "come om comleds",
                duration: "4:04",
                url: "https://wkhggwacipiwxyhggjgx.supabase.co/storage/v1/object/public/Music-covers/AUD-20251215-WA0051.mp3",
                cover: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80"
            },
            {
                id: 2,
                title: "daily buddle",
                artist: "Elijah Kitaka",
                album: "After Hours",
                duration: "3:22",
                url: "https://wkhggwacipiwxyhggjgx.supabase.co/storage/v1/object/public/Music-covers/Elijah%20Kitaka%20-%20Daily%20Bundle%20(Audio)_1766829722113.mp3",
                cover: ""
            },
            {
                id: 3,
                title: "ordinary",
                artist: "Alex Warren",
                album: "Future Nostalgia",
                duration: "3:24",
                url: "https://wkhggwacipiwxyhggjgx.supabase.co/storage/v1/object/public/Music-covers/Alex%20Warren%20-%20Ordinary%20(Official%20Video)_1767221073363.mp3",
                cover: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80"
            },
            {
                id: 4,
                title: "Bad Guy",
                artist: "Billie Eilish",
                album: "When We All Fall Asleep",
                duration: "3:14",
                url: "https://filesamples.com/samples/audio/mp3/sample3.mp3",
                cover: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80"
            }
        ];

        // Sample local tracks
        const sampleLocalTracks = [
            {
                id: 100,
                title: "Local Song 1",
                artist: "Local Artist",
                album: "Local Album",
                duration: "3:45",
                source: "local",
                cover: ""
            },
            {
                id: 101,
                title: "Local Song 2",
                artist: "Local Artist",
                album: "Local Album",
                duration: "4:20",
                source: "local",
                cover: ""
            }
        ];

        // Initialize the player
        function initPlayer() {
            // Set up online tracks
            onlineTracks = [...sampleOnlineTracks];
            uploadedTracks = [...sampleLocalTracks];
            
            // Render online tracks
            renderOnlineTracks();
            
            // Combine tracks for playlist
            updatePlaylist();
            
            // Set initial volume
            audioPlayer.volume = 0.7;
            volumePercent.style.width = '70%';
            
            // Set up event listeners
            setupEventListeners();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Play/Pause button
            playPauseBtn.addEventListener('click', togglePlayPause);
            
            // Previous button
            prevBtn.addEventListener('click', playPrevSong);
            
            // Next button
            nextBtn.addEventListener('click', playNextSong);
            
            // Repeat button
            repeatBtn.addEventListener('click', toggleRepeat);
            
            // Shuffle button
            shuffleBtn.addEventListener('click', toggleShuffle);
            
            // Progress bar
            progressBar.addEventListener('click', seek);
            
            // Volume control
            volumeSlider.addEventListener('click', changeVolume);
            
            // Audio player events
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('loadedmetadata', updateDuration);
            audioPlayer.addEventListener('ended', handleSongEnded);
            
            // Upload modal
            uploadTrigger.addEventListener('click', () => uploadModal.style.display = 'flex');
            closeModal.addEventListener('click', () => uploadModal.style.display = 'none');
            
            // File upload
            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'var(--primary-color)';
                uploadArea.style.background = 'rgba(106, 17, 203, 0.1)';
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                uploadArea.style.background = 'transparent';
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                uploadArea.style.background = 'transparent';
                
                if (e.dataTransfer.files.length) {
                    handleFiles(e.dataTransfer.files);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFiles(e.target.files);
                }
            });
            
            // Add to playlist button
            addToPlaylistBtn.addEventListener('click', addUploadedToPlaylist);
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === uploadModal) {
                    uploadModal.style.display = 'none';
                }
            });
        }

        // Handle file selection
        function handleFiles(files) {
            uploadedFiles.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Check if it's an audio file
                if (!file.type.startsWith('audio/')) {
                    continue;
                }
                
                // Create a preview of the file
                const fileEl = document.createElement('div');
                fileEl.className = 'uploaded-file';
                fileEl.innerHTML = `
                    <div>
                        <div><strong>${file.name}</strong></div>
                        <div class="small-text">${formatFileSize(file.size)}</div>
                    </div>
                    <div>
                        <i class="fas fa-check-circle" style="color: var(--success-color);"></i>
                    </div>
                `;
                
                uploadedFiles.appendChild(fileEl);
                
                // Store file reference (in a real app, you'd process this further)
                const track = {
                    id: Date.now() + i,
                    title: file.name.replace(/\.[^/.]+$/, ""), // Remove extension
                    artist: "Unknown Artist",
                    album: "Uploaded Album",
                    duration: "0:00",
                    source: "local",
                    file: file,
                    cover: ""
                };
                
                uploadedTracks.push(track);
            }
        }

        // Add uploaded files to playlist
        function addUploadedToPlaylist() {
            updatePlaylist();
            uploadModal.style.display = 'none';
            alert(`${uploadedTracks.length - sampleLocalTracks.length} files added to playlist!`);
        }

        // Render online tracks
        function renderOnlineTracks() {
            streamingSection.innerHTML = '';
            
            onlineTracks.forEach(track => {
                const trackEl = document.createElement('div');
                trackEl.className = 'stream-card';
                trackEl.dataset.id = track.id;
                trackEl.innerHTML = `
                    <img src="${track.cover}" alt="${track.title}">
                    <h4>${track.title}</h4>
                    <p>${track.artist}</p>
                    <p class="small-text">${track.duration}</p>
                `;
                
                trackEl.addEventListener('click', () => playOnlineTrack(track.id));
                streamingSection.appendChild(trackEl);
            });
        }

        // Play an online track
        function playOnlineTrack(trackId) {
            const trackIndex = onlineTracks.findIndex(t => t.id === trackId);
            if (trackIndex === -1) return;
            
            const track = onlineTracks[trackIndex];
            
            // Switch to online tracks playlist
            currentSongIndex = trackIndex;
            loadSong(track, 'online');
        }

        // Update playlist display
        function updatePlaylist() {
            playlist.innerHTML = '';
            
            // Combine online and local tracks
            const allTracks = [...onlineTracks, ...uploadedTracks];
            
            allTracks.forEach((track, index) => {
                const li = document.createElement('li');
                li.className = 'playlist-item';
                if (index === currentSongIndex && audioPlayer.src) {
                    li.classList.add('active');
                }
                
                li.dataset.index = index;
                li.dataset.source = track.source || 'online';
                
                li.innerHTML = `
                    <img src="${track.cover || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80'}" alt="${track.title}">
                    <div class="playlist-details">
                        <div class="playlist-title">${track.title}</div>
                        <div class="playlist-artist">${track.artist}</div>
                    </div>
                    <div class="playlist-duration">${track.duration}</div>
                `;
                
                li.addEventListener('click', () => {
                    currentSongIndex = index;
                    loadSong(track, track.source || 'online');
                    updatePlaylist();
                });
                
                playlist.appendChild(li);
            });
        }

        // Load a song into the player
        function loadSong(track, source) {
            // Update UI
            songTitle.textContent = track.title;
            songArtist.textContent = track.artist;
            songAlbum.textContent = track.album;
            
            // Update album art
            if (track.cover) {
                albumArt.innerHTML = `<img src="${track.cover}" alt="${track.title}">`;
            } else {
                albumArt.innerHTML = `<i class="fas fa-music"></i>`;
            }
            
            // Set audio source based on track type
            if (source === 'online') {
                audioPlayer.src = track.url;
            } else if (source === 'local' && track.file) {
                // For local files, create object URL
                audioPlayer.src = URL.createObjectURL(track.file);
            } else {
                // Fallback for sample local tracks
                audioPlayer.src = 'https://filesamples.com/samples/audio/mp3/sample3.mp3';
            }
            
            // Play the song
            playSong();
            
            // Update active item in playlist
            updatePlaylist();
        }

        // Play the current song
        function playSong() {
            audioPlayer.play();
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        // Pause the current song
        function pauseSong() {
            audioPlayer.pause();
            isPlaying = false;
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        }

        // Toggle play/pause
        function togglePlayPause() {
            if (audioPlayer.src) {
                if (isPlaying) {
                    pauseSong();
                } else {
                    playSong();
                }
            } else if (onlineTracks.length > 0) {
                // If no song is loaded, load the first one
                currentSongIndex = 0;
                loadSong(onlineTracks[0], 'online');
            }
        }

        // Play previous song
        function playPrevSong() {
            if (!audioPlayer.src) return;
            
            const allTracks = [...onlineTracks, ...uploadedTracks];
            currentSongIndex = (currentSongIndex - 1 + allTracks.length) % allTracks.length;
            const track = allTracks[currentSongIndex];
            loadSong(track, track.source || 'online');
        }

        // Play next song
        function playNextSong() {
            if (!audioPlayer.src) return;
            
            const allTracks = [...onlineTracks, ...uploadedTracks];
            
            if (isShuffled) {
                currentSongIndex = Math.floor(Math.random() * allTracks.length);
            } else {
                currentSongIndex = (currentSongIndex + 1) % allTracks.length;
            }
            
            const track = allTracks[currentSongIndex];
            loadSong(track, track.source || 'online');
        }

        // Toggle repeat mode
        function toggleRepeat() {
            const modes = ['none', 'one', 'all'];
            const icons = ['fa-redo', 'fa-redo', 'fa-redo-alt'];
            const colors = ['', 'var(--success-color)', 'var(--primary-color)'];
            
            const currentIndex = modes.indexOf(repeatMode);
            repeatMode = modes[(currentIndex + 1) % modes.length];
            
            repeatBtn.innerHTML = `<i class="fas ${icons[(currentIndex + 1) % modes.length]}"></i>`;
            repeatBtn.style.color = colors[(currentIndex + 1) % modes.length];
        }

        // Toggle shuffle
        function toggleShuffle() {
            isShuffled = !isShuffled;
            shuffleBtn.style.color = isShuffled ? 'var(--primary-color)' : '';
        }

        // Update progress bar
        function updateProgress() {
            if (audioPlayer.duration) {
                const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                progress.style.width = `${percent}%`;
                
                // Update current time
                currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            }
        }

        // Update duration display
        function updateDuration() {
            durationEl.textContent = formatTime(audioPlayer.duration);
        }

        // Handle song ended
        function handleSongEnded() {
            if (repeatMode === 'one') {
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else if (repeatMode === 'all') {
                playNextSong();
            } else {
                // Stop at the end
                pauseSong();
                progress.style.width = '0%';
                currentTimeEl.textContent = '0:00';
            }
        }

        // Seek in the song
        function seek(e) {
            if (!audioPlayer.duration) return;
            
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            
            audioPlayer.currentTime = (clickX / width) * duration;
        }

        // Change volume
        function changeVolume(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const volume = clickX / width;
            
            audioPlayer.volume = volume;
            volumePercent.style.width = `${volume * 100}%`;
        }

        // Format time in MM:SS
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Initialize the player when page loads
        window.addEventListener('DOMContentLoaded', initPlayer);
    </script>
</body>
</html>
